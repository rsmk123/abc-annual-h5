# 2026-01-14 变更日志

## 核心功能更新

1.  **数据库数据同步**
    - 实现用户登录后自动拉取云端卡片收集状态。
    - 抽卡结果实时同步至数据库。
    - 修复 API 地址在生产环境 (`h5.actionlist.cool`) 下的调用问题。

2.  **防止连续抽卡优化**
    - **后端更新**：数据库新增 `last_card_index` 字段。
    - **算法调整**：抽卡算法现在会记录上次抽到的卡片，并在下次抽卡时排除该卡片（除非触发保底且只剩该卡未收集），避免用户连续两天抽到同一张卡。

3.  **登录体验优化**
    - **Loading 状态**：点击登录按钮后显示"登录中..."并禁用按钮，防止重复点击。
    - **Toast 提示**：移除原生 `alert` 弹窗，改为更美观的 Toast 浮层提示。
    - **状态反馈**：完善了 API 请求失败、验证码错误等场景的错误提示。

## UI/UX 调整

1.  **开屏页全屏**
    - Welcome Page 现在使用 `ClientPortal` 渲染到 `document.body`，确保在异形屏手机上也能完美全屏覆盖。
    - 视频和背景图设置为 `object-cover`，支持左右裁切以适配不同屏幕比例。

2.  **抽卡交互**
    - 点击"感谢参与，明天再来"按钮时，会弹出 Toast 提示："每天可抽卡一次，请明天再来哦"。

3.  **资源回退**
    - 骑马动画序列帧已回退至 **63帧旧版本**，修复了新版序列帧导致的动画错位和加载问题。

## 修复的 BUG

- 修复了生产环境下 API 请求 405 Method Not Allowed 问题（因请求发送到了 COS 静态地址）。
- 修复了登录按钮点击无反应（缺少 Loading 反馈）的问题。
- 修复了 FinalRewardModal 中透明热区遮挡滚动条的问题。

## 操作记录

- 执行了 `git restore` 回退代码至稳定版本。
- 手动恢复了骑马序列帧图片资源。
- 重新应用了今日开发的核心功能代码。
- 更新了云函数 `abc-bank-h5-api` 和数据库结构。

